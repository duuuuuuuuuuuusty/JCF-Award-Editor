<style>#curtain,#mass{border:2px dashed #f3f3f3;width:906px}table{padding:0;border-collapse:collapse;border-spacing:0}td,th,tr{border-collapse:collapse;padding:0;border-spacing:0;font-family:Century Gothic,Verdana;font-weight:300}th{border-left:1px solid #cacaca;border-right:1px solid #cacaca}input{border:none;border-spacing:0}#mass tr:nth-of-type(2n+1) input{background:#fff none repeat scroll 0 0}#mass tr:nth-of-type(2n) input{background:#e2ffff none repeat scroll 0 0}tr.toupload input{background:#fbf6b3 none repeat scroll 0 0!important}tr.toremove input{background-color:rgba(256,36,21,.5)!important}.rmicon{color:rgba(256,36,21,.8)}.controls,.rmrow{cursor:pointer}.removed{opacity:.2;pointer-events:none!important}tr{border-collapse:collapse;display:table-row-group;margin-left:1px;padding:0!important}.cell1{text-align:center;width:30px}.cell3{width:170px}.cell5{width:100px}.cell6{width:264px}.cell7{width:66px}#acpid,#clearsort,#findme,#pt_se,#replaceme,#result,#rmsel,#sortgo,#sortphrase,#swapandgo{border:1px solid #cacaca;background:initial!important;color:#000}#logbtn,#logpw,#logusn{background:#f3f3f3;margin:2px;color:#000}select.cell7[default=undefined]{display:none}.controls{display:table-cell;font-size:16px;position:absolute;margin-top:-2px}.uploadcan{margin-left:14px}</style><div id=curtain><div id=login><input id=logusn placeholder=Username...> <input id=logpw type=password placeholder=Password...> <input id=logbtn type=button value=Login> <input id=acpid placeholder="No session found"autocomplete=off> <input id=getdata type=button value="Build Awards Table"style=display:none></div><table id=mass><tr><th>#<th>Awarded To<th>Award Name<th>Award Image<th>Given By<th>Award Description<th>Display?<tr><td colspan=4><input id=pt_se type=button value="Submit Edits"> <input id=result placeholder=Console readonly style="font-style:italic;font-size:11px;padding:3px 10px;width:288px"autocomplete=off><td colspan=3 align=right><select id=sortmenu><option value=2>By Username..<option value=3>By Award Name..</select><input id=sortphrase placeholder="Enter search phrase.."autocomplete=off> <input id=sortgo type=button value=Search> <input id=clearsort type=button value=⎌ alt="Reset search parameters"><tr><td colspan=2><input id=rmsel type=button value="Delete Selected"><td colspan=5 align=right>Replace<select id=replacemenu><option value=3>By Award Name..<option value=4>By Image..<option value=5>By 'Given By'..<option value=6>By Description..</select><input id=findme placeholder="Replace this phrase.."autocomplete=off> <input id=replaceme placeholder=".. With this phrase"autocomplete=off> <input id=swapandgo type=button value="Mark for Upload"></table></div><script>function _addMID(e){_asyncupload("GET","/admin.php?",{act:"mysql",adsess:e,code:"dump",line:"0",part:"40"},"false",function(){$("#result").val("MID table dump created, downloading (4s delay).."),_getdata(e)},$("#result").val("Creation failed"))}function _getdata(e){console.log("Beginning download "),_sleep(4e3);var a=window.location.host,l=a.indexOf(".");_asyncupload("GET","/boardservice/sqls/"+e+"-"+a.substring(0,l)+"_.sql",{},"false",function(e){_datasplit(e),$("#result").val("Downloaded data")},$("#result").val("Download failed"))}function _datasplit(e){var a=e.split(/\n/g);console.log(a);var l=searchStringInArray("_members` VALUES (",a);console.log(l);var t=a.slice(0,l),o=a.slice(l);console.log(t),console.log(o),$("#result").val("Data split, sending block 1 to parser.."),_parser(t,o)}function searchStringInArray(e,a){for(var l=0;l<a.length&&-1==a[l].indexOf(e);l++);return l}function _parser(e,a){$("#result").val("Block 1 received, parsing.."),_sleep(1e3);var l=1;console.log(e),"undefined"!=$("table#mass tbody tr").attr("id")&&$(this).remove(),$.each(e,function(){var e=document.getElementById("mass").insertRow(1),a=this,t=(t=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")).match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g))||[];e.id="t"+l++;for(var o=t.length-1,n=0;n<o;n++)t[n]=t[n].replace(/^"/,"").replace(/"$/,"").replace(/'/g,"&#39;").replace(/"/g,"&#34;"),e.insertCell(n).innerHTML="<input type='text' class='evalme cell"+(n+1)+"' default='"+t[n]+"' value='"+t[n]+"'>";console.log(t),t[6]>0?e.insertCell(-1).innerHTML="<select class='cell7' default='"+t[6]+"'><option value='1' selected>Yes</option><option value='0'>No</option></select>":e.insertCell(-1).innerHTML="<select class='cell7' default='"+t[6]+"'><option value='1'>Yes</option><option value='0' selected>No</option></select>",e.insertCell(-1).innerHTML="<div class='rmrow'>✗</div>"}),$(".cell1, .cell2").attr("readonly",""),$("tr#t1").length>0?$("#result").val("Awards data tabulated"):$("#result").val("Error: Data not detected - Reload"),_midparse(a),_markforupload()}function _midparse(e){$("#result").val("Block 2 received, parsing..");var a={},l=$("input.evalme.cell2");$.each(e,function(){var e=this,l=e.substring(e.indexOf("(")+1,e.indexOf('", ')).split(', "');a[(l=l||[])[0]]=l[1]}),$.each(l,function(){var e=$(this),l=e.val();e.val($("<div>").html(a[l]).text())}),$("#result").val("All data parsed")}function _markforupload(){$(".cell3, .cell4, .cell5, .cell6, .cell7").focusout(function(){var e=$(this).parent("td").parent("tr").attr("id"),a=$(this).val(),l=$('<span class="uploadind controls">☑</span> <span class="uploadcan controls">☒</span>'),t=$(this).attr("default");console.log("row "+e+" has lost focus"),""!=a&&a!=t?($("#"+e).addClass("toupload").append(l),console.log("row "+e+" marked for upload")):($("#"+e).removeClass("toupload").children(".controls").remove(),console.log("row "+e+" unmarked for upload"))})}function _sort(e){$(".cell"+e[0]+":not(.cell"+e[0]+'[value="'+e[1]+'"])').parent("td").parent("tr").css({position:"absolute",top:"-1000px"})}function _upload(e){acpsess=$("#acpid").val(),console.log("Uploading with dataset: "),console.log(e),$.ajax({method:"POST",url:"/admin.php?adsess="+acpsess+"&code=do_awardsedit&act=awards",timeout:8e3,data:{id:e[1],mid:e[7],name:e[2],image:e[3],givenby:e[4],description:e[5],display:e[6]},success:function(){$("#result").val("Award #"+e[1]+" - Sent"),$("tr#t"+e[1]).removeClass("toupload").children(".controls").remove()},error:function(a,l){$("#result").va("Award #"+e[1]+": Upload failed!")}})}function _asyncupload(e,a,l,t,o,n){$("#acpid").val();$.ajax({method:e,url:a,timeout:8e3,data:l,async:t,success:o,error:n,statusCode:{200:$("#result").val("200 OK - Sending"),404:$("#result").val("404 not found - Halted - Retrying if possible")}})}function _sleep(e){for(var a=(new Date).getTime(),l=0;l<1e7&&!((new Date).getTime()-a>e);l++);}$("#logbtn").click(function(){$.get("/admin.php?login=yes",{username:$("#logusn").val(),password:$("#logpw").val()},function(e){var a=e.search("adsess="),l=e.substr(a+7,32);$("#acpid").val(l),$("#logbtn").val("Signed In"),$("#getdata").css("display","unset")})}),$(document).on("click","input#getdata",function(){$("#result").val("Requesting award table - Hang onto your butts!"),_sleep(20);var e=$("#acpid").val();_asyncupload("GET","/admin.php?",{act:"mysql",adsess:e,code:"dump",line:"0",part:"8"},"false",function(){$("#result").val("MySQL dump created, requesting MID table"),_addMID(e)},$("#result").val("Creation failed"))}),$(document).on("click","span.uploadind",function(){da={};var e=0,a=$(this).parent(".toupload");$.each($(a).find("input:not(.cell2)"),function(){e+=1,da[e]=$(this).val()}),da[6]=a.find("select.cell7").val(),da[7]=a.find("input.evalme.cell2").attr("default"),console.log(da),_upload(da),$("#result").val("Award #"+a.attr("id")+" - Sent"),a.removeClass("toupload").children(".controls").remove()}),$(document).on("click","span.uploadcan",function(){var e=$(this).parent(".toupload");$.each($(e).find("input:not(.cell2), select"),function(){var e=$(this).attr("default");$(this).attr("value",e)}),e.removeClass("toupload").children(".controls").remove(),$("#result").val("Award #"+e.attr("id")+" - Reset")}),$(document).on("click","#pt_se",function(){$.each($(".toupload"),function(){dm={};var e=$(this);$.each(e.find("input:not(.cell2)"),function(e){var e=e+1;dm[e]=$(this).val()}),dm[6]=e.find("select.cell7").val(),dm[7]=e.find("input.evalme.cell2").attr("default"),console.log(dm),_upload(dm),e.find(".controls").remove(),e.removeClass("toupload")})}),$(document).on("click",".rmrow",function(){$(this).parent("td").parent("tr").toggleClass("toremove"),$(this).toggleClass("rmicon")}),$("#rmsel").click(function(){console.log("Running delete..");var e=$("#acpid").val();$.each($(".toremove"),function(){$.get("/admin.php?adsess="+e+"&act=awards&code=awardsdelete",{id:$(this).find(".cell1").val()},function(){$("#result").val("Awards deleted"),$(".toremove").addClass("removed").removeClass("toremove")})})}),$("#swapandgo").click(function(){var e=$("#replacemenu").val(),a=$('<span class="uploadind controls">☑</span> <span class="uploadcan controls">☒</span>'),l=$("#findme").val(),t=$("#replaceme").val();$(".cell"+e+'[value="'+l+'"]').val(t).parent("td").parent("tr").addClass("toupload").append(a)}),$("#sortgo").click(function(){var e=[$("#sortmenu").val(),$("#sortphrase").val()];$("#mass tr").css({position:"unset",top:"unset"}),console.log(e),_sort(e)}),$("#clearsort").click(function(){$("#mass tr").css({position:"unset",top:"unset"})})</script>
